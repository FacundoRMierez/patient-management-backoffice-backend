# Sistema de InternacionalizaciÃ³n (i18n)

## ğŸ“‹ DescripciÃ³n

El backend implementa un sistema completo de internacionalizaciÃ³n con **mensajes en EspaÃ±ol e InglÃ©s** siguiendo las mejores prÃ¡cticas REST API.

## ğŸ¯ Formato Estandarizado

**TODAS las respuestas** siguen el mismo formato consistente:

### âœ… Respuestas de Ã‰xito

```json
{
  "success": true,
  "message": {
    "es": "Usuario registrado exitosamente.",
    "en": "User registered successfully."
  },
  "data": {
    "id": "...",
    "email": "..."
  }
}
```

### âŒ Respuestas de Error

```json
{
  "success": false,
  "error": {
    "es": "Cuenta pendiente de aprobaciÃ³n. Por favor contacte a un administrador.",
    "en": "Account is pending approval. Please contact an administrator."
  }
}
```

### ğŸ“Š Respuestas con PaginaciÃ³n

```json
{
  "success": true,
  "message": {
    "es": "Usuarios obtenidos exitosamente.",
    "en": "Users retrieved successfully."
  },
  "data": [...],
  "meta": {
    "count": 10
  }
}
```

## ğŸ“š CategorÃ­as de Mensajes

### ğŸ” AutenticaciÃ³n (`auth`)
- `accountPendingApproval` - Cuenta pendiente de aprobaciÃ³n
- `accountInactive` - Cuenta inactiva
- `invalidCredentials` - Credenciales invÃ¡lidas
- `emailAlreadyExists` - Email ya existe
- `userNotFound` - Usuario no encontrado
- `tokenInvalid` - Token invÃ¡lido
- `unauthorized` - No autorizado
- `forbidden` - Acceso denegado

### ğŸ‘¤ GestiÃ³n de Usuarios (`user`)
- `registered` - Usuario registrado
- `loginSuccessful` - Inicio de sesiÃ³n exitoso
- `retrieved` - Usuario obtenido
- `allRetrieved` - Usuarios obtenidos
- `pendingRetrieved` - Usuarios pendientes obtenidos
- `profileRetrieved` - Perfil obtenido
- `created` - Usuario creado
- `updated` - Usuario actualizado
- `deleted` - Usuario eliminado
- `approved` - Usuario aprobado
- `alreadyApproved` - Ya aprobado
- `passwordChanged` - ContraseÃ±a cambiada
- `currentPasswordIncorrect` - ContraseÃ±a actual incorrecta

### âœ… ValidaciÃ³n (`validation`)
- `invalidEmail` - Email invÃ¡lido
- `passwordTooShort` - ContraseÃ±a muy corta
- `requiredField` - Campo requerido
- `invalidRole` - Rol invÃ¡lido

### âš™ï¸ General (`general`)
- `success` - OperaciÃ³n exitosa
- `error` - Error general
- `notFound` - No encontrado
- `serverError` - Error del servidor

## ğŸ’» Uso para Desarrolladores

### Helpers Disponibles

```typescript
import { 
  createSuccessResponse, 
  createPaginatedResponse,
  createErrorResponse,
  getMessageBoth 
} from '../config/messages';

// Respuesta de Ã©xito simple
res.json(createSuccessResponse('user.registered'));

// Respuesta de Ã©xito con datos
res.json(createSuccessResponse('user.retrieved', userData));

// Respuesta paginada
res.json(createPaginatedResponse('user.allRetrieved', users));

// Respuesta de error
res.json(createErrorResponse('auth.invalidCredentials'));
```

### En Servicios

```typescript
import { getMessageBoth } from '../config/messages';

// Crear error con i18n
if (!user.isApproved) {
  const error: any = new Error(getMessageBoth('auth.accountPendingApproval').es);
  error.i18n = getMessageBoth('auth.accountPendingApproval');
  throw error;
}
```

### En Controladores

```typescript
// âœ… CORRECTO - Usar helpers
res.status(200).json(createSuccessResponse('user.updated', user));

// âŒ INCORRECTO - No hardcodear mensajes
res.status(200).json({ message: 'User updated', data: user });
```

### En el Frontend

El frontend puede verificar el estado y elegir el idioma:

```typescript
// Verificar si fue exitoso
if (response.data.success) {
  const message = response.data.message; // { es: "...", en: "..." }
  
  // Detectar idioma del navegador
  const userLang = navigator.language.startsWith('es') ? 'es' : 'en';
  
  // Mostrar mensaje
  console.log(message[userLang]);
} else {
  // Manejar error
  const error = response.data.error; // { es: "...", en: "..." }
  console.error(error[userLang]);
}
```

### Ejemplo React/Next.js

```typescript
// Hook personalizado para i18n
const useLang = () => {
  const [lang, setLang] = useState<'es' | 'en'>('es');
  
  useEffect(() => {
    const browserLang = navigator.language.startsWith('es') ? 'es' : 'en';
    setLang(browserLang);
  }, []);
  
  return lang;
};

// Componente
function MyComponent() {
  const lang = useLang();
  const [message, setMessage] = useState('');
  
  const handleSubmit = async () => {
    try {
      const res = await fetch('/api/users/login', { ... });
      const data = await res.json();
      
      if (data.success) {
        setMessage(data.message[lang]); // Mensaje en idioma correcto
      } else {
        setMessage(data.error[lang]); // Error en idioma correcto
      }
    } catch (error) {
      console.error(error);
    }
  };
  
  return <div>{message}</div>;
}
```

## ğŸ”„ Ejemplos de Respuestas

### âœ… Login Exitoso

**Request:**
```bash
POST /api/users/login
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Response (200):**
```json
{
  "success": true,
  "message": {
    "es": "Inicio de sesiÃ³n exitoso.",
    "en": "Login successful."
  },
  "data": {
    "user": {
      "id": "...",
      "email": "user@example.com",
      "firstName": "John",
      "roles": ["PROFESSIONAL"]
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

### âŒ Error - Usuario Pendiente de AprobaciÃ³n

**Response (400):**
```json
{
  "success": false,
  "error": {
    "es": "Cuenta pendiente de aprobaciÃ³n. Por favor contacte a un administrador.",
    "en": "Account is pending approval. Please contact an administrator."
  }
}
```

### âŒ Error - Credenciales InvÃ¡lidas

**Response (400):**
```json
{
  "success": false,
  "error": {
    "es": "Credenciales invÃ¡lidas.",
    "en": "Invalid credentials."
  }
}
```

### âœ… Usuario Eliminado

**Request:**
```bash
DELETE /api/users/123
```

**Response (200):**
```json
{
  "success": true,
  "message": {
    "es": "Usuario eliminado exitosamente.",
    "en": "User deleted successfully."
  }
}
```

### âœ… Lista de Usuarios

**Request:**
```bash
GET /api/users
```

**Response (200):**
```json
{
  "success": true,
  "message": {
    "es": "Usuarios obtenidos exitosamente.",
    "en": "Users retrieved successfully."
  },
  "data": [
    { "id": "1", "email": "user1@example.com", ... },
    { "id": "2", "email": "user2@example.com", ... }
  ],
  "meta": {
    "count": 2
  }
}
```

### âŒ Error de ValidaciÃ³n (Zod)

**Response (400):**
```json
{
  "success": false,
  "error": {
    "es": "Error de validaciÃ³n",
    "en": "Validation error"
  },
  "details": [
    {
      "field": "email",
      "message": "Invalid email"
    }
  ]
}
```

## ğŸ¯ Ventajas

âœ… **Formato Consistente**: Todas las respuestas siguen el mismo patrÃ³n con `success` boolean  
âœ… **Frontend Flexible**: El frontend puede elegir el idioma a mostrar  
âœ… **FÃ¡cil DetecciÃ³n**: Campo `success` permite identificar fÃ¡cilmente Ã©xitos vs errores  
âœ… **SEO Mejorado**: Soporte multi-idioma desde el backend  
âœ… **Mantenibilidad**: Todos los mensajes centralizados en un archivo  
âœ… **Escalabilidad**: FÃ¡cil agregar mÃ¡s idiomas en el futuro  
âœ… **UX Mejorada**: Mensajes claros en el idioma del usuario  
âœ… **Type-Safe**: Helpers TypeScript previenen errores  

## ğŸ“ Estructura del Sistema

```
src/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ messages.ts          # â­ Sistema i18n centralizado
â”‚       â”œâ”€â”€ messages          # Objeto con todos los mensajes
â”‚       â”œâ”€â”€ getMessage()      # Obtener mensaje en un idioma
â”‚       â”œâ”€â”€ getMessageBoth()  # Obtener objeto {es, en}
â”‚       â”œâ”€â”€ createSuccessResponse()    # Helper respuesta Ã©xito
â”‚       â”œâ”€â”€ createErrorResponse()      # Helper respuesta error
â”‚       â””â”€â”€ createPaginatedResponse()  # Helper respuesta paginada
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ user.controller.ts   # Usa helpers i18n
â”œâ”€â”€ services/
â”‚   â””â”€â”€ user.service.ts      # Lanza errores con i18n
â””â”€â”€ middlewares/
    â”œâ”€â”€ auth.middleware.ts   # Respuestas i18n
    â”œâ”€â”€ authorize.middleware.ts  # Respuestas i18n
    â””â”€â”€ error.middleware.ts  # Maneja errores con i18n
```  

## ğŸš€ Futuras Mejoras

- [ ] Agregar mÃ¡s idiomas (portuguÃ©s, francÃ©s, etc.)
- [ ] Sistema de preferencias de idioma por usuario
- [ ] Header `Accept-Language` para detecciÃ³n automÃ¡tica
- [ ] Traducciones de mensajes de validaciÃ³n de Zod
- [ ] InterpolaciÃ³n de variables en mensajes dinÃ¡micos
